<launch>
  <!-- NO PARAMS HERE - PARAMS MUST BE SET ON THE NVIDIA DRIVE -->
  <!-- NO CONFIG FILES HERE - CONFIG FILES MUST BE CROSSCOMPILED ALONG WITH THE NODE -->
  <!-- https://gitlab.cs.ut.ee/autonomous-driving-lab/autoware.ai/local/sekonix_camera_ut -->

  <arg name="framerate" default="30" doc="camera framerate"/>
  <arg name="encoder" default="jpg" doc="{jpg, h264}"/>
  <arg name="uncompress" default="false" doc="uncompress images"/>
  <arg name="rectify" default="false" doc="rectify images" />
  <arg name="h264_bitrate" default="8000000" doc="H264 Bitrate"/>  

  <machine name="nvidia_drive"
           address="tegra-ubuntu"
           user="nvidia"
           env-loader="/home/nvidia/crosscompiled/ros/install_isolated/env.sh" />
  <node machine="nvidia_drive" pkg="nvidia_gmsl_driver_ros" type="nvidia_gmsl_driver_ros_node" name="nvidia_gmsl_driver_ros">
    <param name="framerate" value="$(arg framerate)" />
    <param name="encoder" value="$(arg encoder)" />
    <param name="h264_bitrate" value="$(arg h264_bitrate)" />
  </node>

  <include if="$(eval uncompress and encoder=='jpg')" file="$(find vehicle_platform)/launch/nvidia_cameras_decoder.launch">
    <arg name="image_transport_plugin" value="compressed"/>
    <arg name="rectify" value="$(arg rectify)"/>
  </include>
  <include if="$(eval uncompress and encoder=='h264')" file="$(find vehicle_platform)/launch/nvidia_cameras_decoder.launch">
    <arg name="image_transport_plugin" value="h264"/>
    <arg name="rectify" value="$(arg rectify)"/>
  </include>
</launch>
